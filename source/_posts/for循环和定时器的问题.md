---
title: for循环和定时器的问题
date: 2017-04-12 13:12:56
categories: Javascript
tags:
- Javascript
- For循环和定时器
---

````
for (var i = 0; i <= 3; i++) {
  setTimeout(function () {
    console.log(i);
  }, 0);//立刻打印4个4
}````
1.因为JavaScript 是单线程执行的，也就是无法同时执行多段代码，当某一段代码正在执行的时候，所有后续的任务都必须等待，形成一个队列，一旦当前任务执行完毕，再从队列中取出下一个任务。这也常被称为 “阻塞式执行”。
2.如果代码中设定了一个 setTimeout，那么浏览器便会在合适的时间，将代码插入任务队列，如果这个时间设为 0，就代表立即插入队列，但不是立即执行，仍然要等待前面代码执行完毕。而在我们这个demo里for循环就是所谓的前面的代码，定时器执行的时机只能是在for循环结束，所以此时的i已经为4了。
3.for循环内的setTimeOut.,从循环开始到结束的一瞬间开启了i个定时器，但定时器什么事都没有做，等到时间了定时器结束要执行alert命令时，i已经是最后的i了，所以弹出来的都是最后的i。

````
for (var i = 0; i <= 3; i++) {
    setTimeout(function  (a) {
        console.log(a);//依次打印1,2,3,4
    }(i),0);
}````
1.因为在你第二个for循环中的setTimeout里面不只是一个简单的匿名函数，而是你定义了一个匿名函数后就立马执行了（因为你函数定义后使用了(i)进行调用并把i当做参数传到函数里），此处立马执行的意思是代码执行到这里，这个函数就被调用了...所以就开始打印0，1，2，3，4
2.而setTimeout延迟0并不代表你使用了setTimeout之后0秒就立即执行了，如果0秒立即执行，那么会先执行setTimeout设置的延迟0所应该调用的函数然后才继续执行下面的代码，而此处0是指设定一个任务，当现有的任务执行完了之后延迟0（若有设置时间则延迟相应的时间）开始执行，所以此处会先执行完现有的代码之后才会执行所谓的延迟0的那个该调用的函数
